# LeetCode 221. 最大正方形 - 代码分析

你的代码有几个问题：

1. **DP 状态定义错误**：在你的代码中，`f[i][j]` 的意图似乎是表示以 `(i,j)` 为右下角的最大正方形边长，但实际逻辑有误。

2. **递推关系不完整**：

   ```python
   if matrix[i][j] == "1":
       f[i][j] = 1
       if matrix[i - 1][j] == "1" and matrix[i][j - 1] == "1":
           f[i][j] = f[i - 1][j - 1] + 1
   ```

   这段逻辑不足以确保形成的是一个全为 1 的正方形。需要考虑上方、左方和左上方的最小 DP 值。

3. **边界条件初始化错误**：初始化第一行和第一列时直接判断当前格子是否为"1"的做法是正确的，但后续的递推公式没有正确利用这些初始值。

## 修正后的代码

```python
def maximalSquare(self, matrix: List[List[str]]) -> int:
    if not matrix or not matrix[0]:
        return 0

    n, m = len(matrix), len(matrix[0])
    f = [[0] * m for _ in range(n)]
    max_side = 0

    # 初始化第一行和第一列
    for i in range(n):
        if matrix[i][0] == "1":
            f[i][0] = 1
            max_side = 1

    for j in range(m):
        if matrix[0][j] == "1":
            f[0][j] = 1
            max_side = 1

    # 填充DP数组
    for i in range(1, n):
        for j in range(1, m):
            if matrix[i][j] == "1":
                # 关键：取上方、左方和左上方的最小值 + 1
                f[i][j] = min(f[i-1][j], f[i][j-1], f[i-1][j-1]) + 1
                max_side = max(max_side, f[i][j])

    return max_side * max_side
```

## 解释

正确的动态规划思路是：

- `f[i][j]` 表示以 `(i,j)` 为右下角的最大正方形的边长
- 当 `matrix[i][j] == "1"` 时，`f[i][j] = min(f[i-1][j], f[i][j-1], f[i-1][j-1]) + 1`
- 最终答案是 `max_side * max_side`，其中 `max_side` 是所有 `f[i][j]` 中的最大值

这种方法能确保找到的正方形内部全部都是'1'。

## 为什么要取三者的最小值？

在计算 `f[i][j]` 时，我们取 `f[i-1][j]`（上方）、`f[i][j-1]`（左方）和 `f[i-1][j-1]`（左上方）三者的最小值，原因如下：

1. **正方形的几何性质**：要在位置 `(i,j)` 形成一个边长为 k 的正方形，必须保证:

   - 以 `(i-1,j)` 为右下角能形成边长为 k-1 的正方形
   - 以 `(i,j-1)` 为右下角能形成边长为 k-1 的正方形
   - 以 `(i-1,j-1)` 为右下角能形成边长为 k-1 的正方形

2. **木桶原理**：正方形的大小受限于最短的那一边。如果三个位置中有任何一个位置形成的正方形较小，那么以 `(i,j)` 为右下角的正方形就无法扩展得更大。

3. **实例说明**：

   - 假设 `f[i-1][j] = 2`（上方可以形成边长为 2 的正方形）
   - `f[i][j-1] = 3`（左方可以形成边长为 3 的正方形）
   - `f[i-1][j-1] = 2`（左上方可以形成边长为 2 的正方形）

   此时，以 `(i,j)` 为右下角最大能形成的正方形边长为 min(2,3,2) + 1 = 3。

   如果我们不取最小值，比如直接使用 `f[i-1][j-1] + 1`，可能会包含一些值为'0'的元素，从而得到错误结果。

这种动态规划方法确保我们找到的正方形内部全部都是'1'，并且能够正确计算最大的正方形大小。
